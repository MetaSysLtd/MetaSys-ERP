[CRITICAL STABILITY & WORKFLOW BLOCK â€“ ERP FOUNDATION LAYER]
Before building more features or polishing UI, you must fully implement and stabilize the core architecture and workflows across the ERP system.

This block includes the minimum required capabilities for MetaSys ERP to be considered stable, secure, and operationally viable.

ğŸ”¹ SECTION 1: FOUNDATIONAL BLOCKS (MUST-HAVE)
1.1 USER MANAGEMENT & ROLE-BASED ACCESS CONTROL
âœ… Fully implement the following:

Assign users to:

an Organization

a Team (Sales, Dispatch, HR, Finance)

a Role (Admin, Manager, Team Lead, Agent)

Allow setting of permissions per user:

View only

Create

Edit

Delete

âœ… Permissions should restrict access to:

CRM (Leads)

Dispatch (Loads, Clients)

Finance (Invoices)

HR (Onboarding, Leave requests)

âœ… Backend schema must include:

ts
Copy
Edit
users: {
  id,
  name,
  email,
  orgId,
  teamId,
  roleId,
  permissions: { canView: [], canEdit: [], canCreate: [], canDelete: [] }
}
âœ… Show/hide modules in sidebar based on permissions.

âœ… Return friendly error if user accesses restricted page:

â€œYou donâ€™t have permission to view this section. Contact your admin.â€

1.2 VALIDATION & FALLBACK HANDLING
âœ… Every form in the ERP must have:

Required fields flagged clearly

Field types validated:

Email format

CNIC length = 13 digits

Percentage values = between 0â€“100

Backend-side validation (Zod or express-validator)

âœ… No form or DB function should accept null or undefined for critical fields.

âœ… Add fallback defaults:

If no team found â†’ show â€œUnassignedâ€

If no data in list view â†’ show friendly empty state

âœ… NEVER throw a crash like â€œCannot convert undefined to object.â€ Handle all with fallbacks.

1.3 ERROR RECOVERY & SESSION MANAGEMENT
âœ… If API fails (500/404), frontend shows banner:

â€œSomething went wrong. Weâ€™re working on it.â€

âœ… Add /api/health check

âœ… If session expires:

Auto logout and redirect to login

Show:

â€œSession expired. Please log in again.â€

âœ… Wrap all page loads in error boundaries â€” no blank screens.

1.4 NOTIFICATIONS & AUDIT TRAILS
âœ… Every critical action must create a notification entry:

Lead converted â†’ notify Sales Manager

Load booked â†’ notify Dispatch Lead

Invoice sent â†’ notify Dispatcher + Admin

New employee â†’ notify HR

âœ… Backend schema:

ts
Copy
Edit
notifications: {
  id,
  userId,
  orgId,
  title,
  body,
  read: false,
  linkTo: "/crm/leads/123"
}
âœ… Add audit log for Admin:

Log action

User

Timestamp

Metadata

âœ… Show last 10 system-level alerts on Admin Dashboard.

1.5 DASHBOARD ROLE-AWARENESS
âœ… Dashboard must show data based on user role:

Agent sees: own leads, tasks, calls

Team Lead sees: own team

Manager sees: multiple teams

Admin sees: all data + KPIs

ğŸ”¹ SECTION 2: CRITICAL INTERCONNECTED WORKFLOWS
These are cross-departmental flows between Sales, Dispatch, Invoicing, and Reporting.
They must be functionally complete and connected.

2.1 CRM â†’ DISPATCH HANDOFF WORKFLOW
âœ… In CRM (Leads):

When a sales agent selects status â€œHand to Dispatchâ€

â†’ system should create a record in dispatch_clients

â†’ Dispatch Team Lead gets notification:

â€œNew Lead Assigned: [Lead Name]â€

âœ… Dispatcher opens the lead and adds:

First Load info (origin, destination, value, service fee %)

Notes + POD upload (optional)

âœ… Once first load is completed:

Lead status auto-updates to Active

Notification sent to:

Sales Agent

Admin

Dispatcher

Team Lead(s)

âœ… This should be reflected across:

CRM â€œStatus: Activeâ€

Dispatch Clients view

Admin Dashboard â†’ â€œNew Onboarded Clientâ€

2.2 DISPATCH â†’ INVOICE FLOW
âœ… For every completed load:

Dispatcher enters load details

System calculates dispatch fee using % stored against client

System generates invoice record

âœ… On Sunday (weekly close):

System auto-batches invoices per carrier

Groups all loads

Sends invoice to carrier email (optional)

âœ… Dispatcher + Admin get notified:

â€œInvoice sent to [Carrier Name]: $1,350â€

âœ… Admin Dashboard:

New card â†’ â€œThis Weekâ€™s Invoicesâ€

Breakdown:

Total Invoice Value

Total Cleared

Total Pending

âœ… Dispatcher can view:

Their own invoiced clients

Status: Sent / Paid / Overdue

2.3 TEAM REPORTING FLOW
âœ… CRM & Dispatch must both generate:

Daily Summary (Slack + Email optional)

Weekly Recap:

Leads generated

Loads booked

Clients onboarded

Revenue booked

Invoice status

âœ… Dashboard graphs should show:

CRM â†’ Conversion rate, average touchpoints

Dispatch â†’ Avg load value, per-agent booking

2.4 STATUS-SYNC LOGIC (SYSTEM-WIDE)
âœ… Whenever status changes (e.g., lead becomes Active):

It must reflect in:

CRM

Dispatch Clients

Invoicing module

Admin Dashboard

Reports

Notifications

âœ… Do NOT hardcode status updates in one place â€” make it socket-driven or DB-watched and synced.

2.5 END-TO-END FLOW TEST (MANDATORY)
âœ… Ensure this path works completely:

Add CRM Lead

Sales marks â€œHand to Dispatchâ€

Dispatcher adds First Load

System updates to â€œActiveâ€

Invoice generates

Admin sees data on dashboard

All users receive relevant notifications

FINAL OUTPUT REQUIRED
âœ… Once all these blocks are implemented:

No more crashes on login or data load

Every departmentâ€™s core functionality is working

Handoff between modules is clean, visible, and logged

Admin dashboard shows correct KPI metrics

System is safe to start testing with real teams