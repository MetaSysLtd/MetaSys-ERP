ğŸ“¦â€¯Commission Logic Brief â€” â€œSalesâ€‘forâ€‘Dispatchâ€ Track

(Share this entire block withâ€¯Replitâ€‘Bot; do not strip anything. It describes the precise business rules â€” the agent can translate to DB tables, cron jobs, and UI.)


---

1.â€¯Scope

Applies only to the Sales agents whose product is Dispatchingâ€‘Services (not SaaS, not Freightâ€‘forwarding, etc.).

Dispatchers themselves have a separate perâ€‘load commission schema â€” ignore for this spec.



---

2.â€¯Definitions


---

3.â€¯Commission Table (PKR)

> Rule: count only leads that reach Active status within the calendar month.



Bonuses

Sales Rep of Month â€” highest Activeâ€‘lead count â†’ +5â€¯000.

Active Trucksâ€¯>â€¯4 â€” each such carrier booked by the rep â†’ +5â€¯000 once per month.

Team Lead Bonus â€” 1â€¯000 Ã— #ActiveLeads after team target met (targetâ€¯=â€¯team size).


Starter / Closer Split:

Take table payout, multiply by 0.60 (Starter) / 0.40 (Closer).
Inbound Lead: payout Ã—â€¯0.75.



---

4.â€¯System Implementation Tasks (for Replitâ€‘Bot)

4.1â€¯Data Model Addâ€‘Ons

lead.activeAt (timestamp)

lead.source enum(sql, mql, inbound)

commission_run table â†’ stores monthly snapshot per user.

Manyâ€‘toâ€‘many lead_salesUsers with role (starter,closer) for split logic.

carrier.truckCount int for Active Trucks bonus.


4.2â€¯Monthly Cron Job

1. Gather ActiveLeadsByUser for previous month.


2. Apply table to compute base commission.


3. Adjust starter/closer splits & inbound factor.


4. Add Salesâ€‘Repâ€‘ofâ€‘Month bonus.


5. Evaluate Activeâ€‘Trucks bonus.


6. If user is Team Lead â†’ check team target, apply 1â€¯000/lead after threshold.


7. Write row(s) into commission_run.


8. Emit notifications + Slack summary.



4.3â€¯UI / Reports

Commissions tab (under CRM) â†’ filter by month; show breakdown rows & totals.

Badge on dashboard: â€œğŸ† Sales Rep of Monthâ€ if earned.

Error banner if payroll cron hasnâ€™t executed by 3rd day of month.


4.4â€¯Edgeâ€‘Case Rules

A lead that becomes Active again later months counts again (retention benefit).

Penalty (â€‘25â€¯% salary) only if 0 Active Leads and rep had â‰¥â€¯20 calls logged.

Table & bonuses stored in commission_policy so Finance can edit via Admin Panel.



---

5.â€¯Acceptance Checklist (Bot selfâ€‘verify)

[ ] Cron generates commission_run rows with correct math.

[ ] Starter & Closer each see their split.

[ ] Inbound lead correctly shows 75â€¯% payout.

[ ] Team Lead bonus fires only after target met.

[ ] UI grid paginates & exports CSV.

[ ] Duplicate processing prevented (idempotent job).


When complete, Bot should reply:
PASS: Dispatchâ€‘Sales commission engine deployed (month YYYYâ€‘MM processed).


---

(End of product brief. Replitâ€‘Bot to design code & migrations internally.)

